–í–ª–∞–¥–∏–º–∏—Ä, —è –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ–ª —Å–∫—Ä–∏–Ω—à–æ—Ç—ã. –°–∏—Ç—É–∞—Ü–∏—è —è—Å–Ω–∞.

### 1. –ü—Ä–æ –æ—à–∏–±–∫—É –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (SQL Editor)

–ù–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ `ERROR: 42P07: relation "guests" already exists`.
–≠—Ç–æ **–û–¢–õ–ò–ß–ù–ê–Ø** –Ω–æ–≤–æ—Å—Ç—å. –≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ —Ç–≤–æ—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É–∂–µ —Å–æ–∑–¥–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞. **–¢–∞–º –Ω–∏—á–µ–≥–æ —Ç—Ä–æ–≥–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ.** –ú–æ–∂–µ—à—å –∑–∞–∫—Ä—ã—Ç—å –≤–∫–ª–∞–¥–∫—É SQL Editor.

### 2. –ü—Ä–æ –æ—à–∏–±–∫—É –Ω–∞ —Å–∞–π—Ç–µ (Console)

–ù–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ –∫–æ–Ω—Å–æ–ª–∏: `Uncaught SyntaxError: Identifier 'supabase' has already been declared`.
–≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –≤ —Ñ–∞–π–ª–µ `index.html` –∫–æ–¥ –≤—Å—Ç–∞–≤–ª–µ–Ω **–¥–≤–∞–∂–¥—ã** (–∏–ª–∏ –ø–æ–≤–µ—Ä—Ö —Å—Ç–∞—Ä–æ–≥–æ). –ë—Ä–∞—É–∑–µ—Ä –≤–∏–¥–∏—Ç –¥–≤–µ –∫–æ–º–∞–Ω–¥—ã "–ø–æ–¥–∫–ª—é—á–∏—Å—å –∫ –±–∞–∑–µ" –∏ –Ω–µ –∑–Ω–∞–µ—Ç, –∫–∞–∫—É—é –≤—ã–ø–æ–ª–Ω—è—Ç—å, –ø–æ—ç—Ç–æ–º—É –ø—Ä–æ—Å—Ç–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è.

---

### üî• –†–ï–®–ï–ù–ò–ï (–ó–∞–π–º–µ—Ç 1 –º–∏–Ω—É—Ç—É)

–¢–µ–±–µ –Ω—É–∂–Ω–æ **–ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—Å—Ç–∏—Ç—å** —Ñ–∞–π–ª `index.html` –ø–µ—Ä–µ–¥ –≤—Å—Ç–∞–≤–∫–æ–π.

1. –û—Ç–∫—Ä–æ–π —Ñ–∞–π–ª `index.html` –≤ —Å–≤–æ–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ.
2. –ù–∞–∂–º–∏ `Ctrl + A` (Windows) –∏–ª–∏ `Cmd + A` (Mac), —á—Ç–æ–±—ã –≤—ã–¥–µ–ª–∏—Ç—å **–í–ï–°–¨** —Ç–µ–∫—Å—Ç.
3. –ù–∞–∂–º–∏ **DELETE**, —á—Ç–æ–±—ã —Ñ–∞–π–ª —Å—Ç–∞–ª **–∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—É—Å—Ç—ã–º**.
4. –°–∫–æ–ø–∏—Ä—É–π –∫–æ–¥ –Ω–∏–∂–µ (—è —É–∂–µ –≤—à–∏–ª —Ç—É–¥–∞ —Ç–≤–æ–∏ –∫–ª—é—á–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ç—ã –ø—Ä–∏—Å–ª–∞–ª).
5. –í—Å—Ç–∞–≤—å –µ–≥–æ –≤ –ø—É—Å—Ç–æ–π —Ñ–∞–π–ª.
6. –°–æ—Ö—Ä–∞–Ω–∏ –∏ –æ—Ç–ø—Ä–∞–≤—å –Ω–∞ GitHub (`git add .`, `git commit -m "fix code"`, `git push`).

```html
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Alpha Cloud</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        /* --- SYSTEM DESIGN (iOS Clean) --- */
        :root { --bg: #F2F2F7; --card: #FFFFFF; --blue: #007AFF; --green: #34C759; --red: #FF3B30; --gray: #8E8E93; --separator: #C6C6C8; }
        body { font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif; background-color: var(--bg); margin: 0; padding: 0; color: #000; -webkit-tap-highlight-color: transparent; overflow-x: hidden; }

        /* Views */
        .view-home { min-height: 100vh; padding-bottom: 40px; }
        .modal-view { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: var(--bg); z-index: 100; transform: translateY(100%); transition: transform 0.35s cubic-bezier(0.165, 0.84, 0.44, 1); display: flex; flex-direction: column; }
        .modal-view.active { transform: translateY(0); }

        /* Header */
        header { padding: 14px 20px; background: rgba(242, 242, 247, 0.95); backdrop-filter: blur(10px); position: sticky; top: 0; z-index: 50; border-bottom: 0.5px solid rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; height: 44px; }
        h1 { font-size: 28px; font-weight: 800; margin: 0; letter-spacing: -0.5px; }
        h2 { font-size: 17px; font-weight: 600; margin: 0; }

        /* Date Button */
        .date-btn-wrapper { position: relative; }
        .date-btn { background: rgba(118, 118, 128, 0.12); color: var(--blue); font-weight: 500; padding: 6px 12px; border-radius: 8px; font-size: 15px; border: none; }
        .date-input-hidden { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; }

        /* Grid */
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; padding: 20px; }
        .table-card { background: var(--card); border-radius: 16px; height: 90px; display: flex; flex-direction: column; justify-content: center; align-items: center; border: none; box-shadow: 0 2px 8px rgba(0,0,0,0.03); position: relative; transition: all 0.1s; }
        .table-card:active { transform: scale(0.95); background: #E5E5EA; }
        .table-card.done { border: 2px solid var(--green); }
        .table-card.done .t-num { color: var(--green); }
        .t-num { font-size: 26px; font-weight: 700; color: var(--blue); }
        .t-lbl { font-size: 12px; color: var(--gray); margin-top: 2px; font-weight: 500; }

        /* List & Controls */
        .list-wrap { padding: 20px; flex: 1; overflow-y: auto; padding-bottom: 120px; }
        .ios-list { background: var(--card); border-radius: 12px; overflow: hidden; }
        .guest-row { display: flex; justify-content: space-between; align-items: center; padding: 14px 16px; border-bottom: 0.5px solid var(--separator); min-height: 24px; }
        .guest-row:last-child { border-bottom: none; }
        .g-name { font-size: 17px; font-weight: 400; color: #000; }
        .del-btn, .rename-btn { color: var(--blue); font-size: 15px; background: none; border: none; padding: 0 10px; }
        
        /* Switch */
        .switch { position: relative; display: inline-block; width: 51px; height: 31px; flex-shrink: 0;}
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #E9E9EA; transition: .3s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 27px; width: 27px; left: 2px; bottom: 2px; background-color: white; transition: .3s; border-radius: 50%; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        input:checked + .slider { background-color: var(--green); }
        input:checked + .slider:before { transform: translateX(20px); }

        /* Fab Bar */
        .fab-bar { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(255,255,255,0.9); backdrop-filter: blur(20px); padding: 12px 20px 30px 20px; border-top: 0.5px solid rgba(0,0,0,0.1); display: flex; gap: 12px; z-index: 101; }
        .btn { flex: 1; padding: 14px; border-radius: 12px; border: none; font-size: 17px; font-weight: 600; cursor: pointer; }
        .btn-main { background: var(--blue); color: white; }
        .btn-sec { background: #E5E5EA; color: var(--blue); }
        .text-btn { background: none; border: none; color: var(--blue); font-size: 17px; padding: 0; cursor: pointer;}
        .add-guest-btn { width: 100%; text-align: left; padding: 16px; background: none; border: none; color: var(--blue); font-size: 17px; border-bottom: 0.5px solid var(--separator); }

        /* Stats */
        .stats-detail { display: none; background: #F8F8F8; padding: 10px 16px; font-size: 14px; color: #555; line-height: 1.8; border-bottom: 0.5px solid var(--separator); }
        .stats-detail.open { display: block; }
        .stat-header { cursor: pointer; font-weight: 500; }
        .count-badge { background: #E5E5EA; color: #000; padding: 4px 8px; border-radius: 6px; font-size: 14px; font-weight: 600; }
        
        .loader { text-align: center; color: var(--gray); padding: 20px; font-size: 14px; }
        .error-msg { color: var(--red); padding: 20px; text-align: center; background: #FFF0F0; border-radius: 12px; margin: 20px; border: 1px solid #FFCDCD; }
    </style>
</head>
<body>

    <div class="view-home">
        <header>
            <h1>Alpha</h1>
            <div class="date-btn-wrapper">
                <button class="date-btn" id="dateBtnLabel">–°–µ–≥–æ–¥–Ω—è</button>
                <input type="date" id="datePicker" class="date-input-hidden" onchange="changeDate(this.value)">
            </div>
        </header>

        <div class="grid" id="tablesGrid">
            <div class="loader">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö...</div>
        </div>

        <div style="padding: 20px;">
            <button onclick="openStats()" class="btn btn-sec" style="width: 100%;">–ò—Å—Ç–æ—Ä–∏—è –∏ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
        </div>
    </div>

    <div id="modal-table" class="modal-view">
        <header>
            <button onclick="closeModal('modal-table')" class="text-btn">–ù–∞–∑–∞–¥</button>
            <h2 id="tableTitle">–°—Ç–æ–ª</h2>
            <div style="width:40px"></div>
        </header>

        <div class="list-wrap">
            <div class="ios-list" id="guestListContainer"></div>
            <div class="ios-list" style="margin-top: 20px;">
                 <button class="add-guest-btn" onclick="addNewGuest()">+ –î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞</button>
            </div>
        </div>

        <div class="fab-bar">
            <button class="btn btn-main" onclick="saveAttendance()" id="saveBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>

    <div id="modal-stats" class="modal-view">
        <header>
            <button onclick="closeModal('modal-stats')" class="text-btn">–ó–∞–∫—Ä—ã—Ç—å</button>
            <h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
            <div style="width: 40px"></div>
        </header>

        <div class="list-wrap" id="statsContent"></div>
    </div>

    <script>
        // ==========================================
        //  –ö–õ–Æ–ß–ò –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø (–£–ñ–ï –í–°–¢–ê–í–õ–ï–ù–´)
        // ==========================================
        
        const SUPABASE_URL = 'https://uwvrcnxztbnmmufevdbz.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV3dnJjbnh6dGJubW11ZmV2ZGJ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg1ODk4MjksImV4cCI6MjA4NDE2NTgyOX0.acH6VuKZZx47j8yCzNpBJwpQyWJUq7BKRKerFPeDGeI';

        // ==========================================

        // –°–æ–∑–¥–∞–µ–º –∫–ª–∏–µ–Ω—Ç–∞ –û–î–ò–ù –†–ê–ó
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        
        let currentTable = null;
        let activeDate = new Date().toISOString().split('T')[0];

        // --- INIT ---
        function init() {
            updateDateLabel();
            loadGridStatuses();
        }

        function updateDateLabel() {
            const label = document.getElementById('dateBtnLabel');
            const today = new Date().toISOString().split('T')[0];
            const parts = activeDate.split('-');
            const formatted = `${parts[2]}.${parts[1]}`;
            
            if (activeDate === today) {
                label.innerText = "–°–µ–≥–æ–¥–Ω—è";
                label.style.color = "var(--blue)";
            } else {
                label.innerText = formatted;
                label.style.color = "var(--red)";
            }
        }

        function changeDate(val) {
            if(!val) return;
            activeDate = val;
            updateDateLabel();
            loadGridStatuses();
        }

        // --- HOME RENDER ---
        async function loadGridStatuses() {
            const grid = document.getElementById('tablesGrid');
            grid.innerHTML = '<div class="loader">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>';

            // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            const { data, error } = await supabase
                .from('attendance')
                .select('table_number')
                .eq('check_date', activeDate);

            if (error) {
                console.error(error);
                grid.innerHTML = `<div class="error-msg"><b>–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–∑–µ!</b><br>–ó–∞—â–∏—Ç–∞ (RLS) –≤—Å—ë –µ—â–µ –≤–∫–ª—é—á–µ–Ω–∞.<br>–ó–∞–π–¥–∏ –≤ Supabase -> Table Editor -> –í—ã–∫–ª—é—á–∏ RLS –¥–ª—è –æ–±–µ–∏—Ö —Ç–∞–±–ª–∏—Ü.</div>`;
                return;
            }

            const activeTables = new Set();
            if (data) data.forEach(r => activeTables.add(r.table_number));

            grid.innerHTML = '';
            for (let i = 1; i <= 12; i++) {
                const btn = document.createElement('button');
                const isDone = activeTables.has(i);
                btn.className = `table-card ${isDone ? 'done' : ''}`;
                btn.innerHTML = `<span class="t-num">${i}</span><span class="t-lbl">–°—Ç–æ–ª</span>`;
                btn.onclick = () => openTable(i);
                grid.appendChild(btn);
            }
        }

        // --- NAVIGATION ---
        async function openTable(num) {
            currentTable = num;
            document.getElementById('tableTitle').innerText = `–°—Ç–æ–ª ‚Ññ${num}`;
            document.getElementById('modal-table').classList.add('active');
            renderGuestList();
        }

        async function openStats() {
            document.getElementById('modal-stats').classList.add('active');
            renderStats();
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
            if(id === 'modal-table') loadGridStatuses();
        }

        // --- TABLE LOGIC ---
        async function renderGuestList() {
            const container = document.getElementById('guestListContainer');
            container.innerHTML = '<div class="loader">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';

            // 1. –ì–æ—Å—Ç–∏ —Å—Ç–æ–ª–∞
            const { data: guests, error: err1 } = await supabase
                .from('guests')
                .select('*')
                .eq('table_number', currentTable)
                .order('full_name');

            // 2. –°—Ç–∞—Ç—É—Å—ã –∑–∞ –¥–∞—Ç—É
            const { data: attendance, error: err2 } = await supabase
                .from('attendance')
                .select('*')
                .eq('check_date', activeDate)
                .eq('table_number', currentTable);

            if (err1 || err2) {
                container.innerHTML = '<div class="error-msg">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞</div>';
                return;
            }

            container.innerHTML = '';
            if (!guests || guests.length === 0) {
                container.innerHTML = '<div style="padding:30px; text-align:center; color:#999">–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç</div>';
                return;
            }

            guests.forEach(guest => {
                const record = attendance.find(r => r.guest_id === guest.id);
                const isChecked = record ? record.is_present : true;

                const div = document.createElement('div');
                div.className = 'guest-row';
                div.innerHTML = `
                    <span class="g-name">${guest.full_name}</span>
                    <label class="switch">
                        <input type="checkbox" ${isChecked ? 'checked' : ''} data-id="${guest.id}">
                        <span class="slider"></span>
                    </label>
                `;
                container.appendChild(div);
            });
        }

        async function addNewGuest() {
            const name = prompt("–ò–º—è –∏ –§–∞–º–∏–ª–∏—è:");
            if (!name) return;

            const { error } = await supabase
                .from('guests')
                .insert([{ full_name: name, table_number: currentTable }]);

            if (error) alert("–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è: " + error.message);
            else renderGuestList();
        }

        async function saveAttendance() {
            const btn = document.getElementById('saveBtn');
            const originalText = btn.innerText;
            btn.innerText = "–°–æ—Ö—Ä–∞–Ω—è–µ–º...";

            const inputs = document.querySelectorAll('#guestListContainer input[type="checkbox"]');
            const updates = [];

            inputs.forEach(input => {
                updates.push({
                    guest_id: input.getAttribute('data-id'),
                    check_date: activeDate,
                    is_present: input.checked,
                    table_number: currentTable
                });
            });

            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ, –ø–∏—à–µ–º –Ω–æ–≤—ã–µ (—á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –¥—É–±–ª–µ–π)
            await supabase.from('attendance').delete()
                .eq('check_date', activeDate)
                .eq('table_number', currentTable);
                
            const { error } = await supabase.from('attendance').insert(updates);

            if (error) {
                alert("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: " + error.message);
                btn.innerText = originalText;
            } else {
                btn.innerText = "–ì–æ—Ç–æ–≤–æ!";
                btn.style.background = "var(--green)";
                setTimeout(() => {
                    closeModal('modal-table');
                    setTimeout(() => { btn.innerText = "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"; btn.style.background = ""; }, 400);
                }, 500);
            }
        }

        // --- STATS LOGIC ---
        async function renderStats() {
            const container = document.getElementById('statsContent');
            container.innerHTML = '<div class="loader">–°—á–∏—Ç–∞–µ–º...</div>';

            const { data: log, error } = await supabase
                .from('attendance')
                .select('*')
                .eq('is_present', true);

            if (error) {
                container.innerHTML = '<div class="error-msg">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</div>';
                return;
            }

            if (!log || log.length === 0) {
                container.innerHTML = '<div style="padding:40px; text-align:center; color:#999">–ò—Å—Ç–æ—Ä–∏–∏ –ø–æ–∫–∞ –Ω–µ—Ç</div>';
                return;
            }

            const dates = [...new Set(log.map(i => i.check_date))].sort().reverse();
            
            container.innerHTML = '<div class="ios-list">';
            dates.forEach((date, index) => {
                const dayLog = log.filter(r => r.check_date === date);
                const total = dayLog.length;

                const byTable = {};
                dayLog.forEach(r => { byTable[r.table_number] = (byTable[r.table_number] || 0) + 1; });

                let detailsHTML = '';
                for(let t=1; t<=12; t++) {
                    if(byTable[t]) {
                        detailsHTML += `<div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                            <span>–°—Ç–æ–ª ${t}</span><span style="font-weight:600">${byTable[t]} —á–µ–ª.</span></div>`;
                    }
                }
                if(detailsHTML === '') detailsHTML = '–ù–∏–∫–æ–≥–æ –Ω–µ –±—ã–ª–æ';

                const dParts = date.split('-');
                const displayDate = `${dParts[2]}.${dParts[1]}.${dParts[0]}`;
                const detailId = `detail-${index}`;

                const div = document.createElement('div');
                div.innerHTML = `
                    <div class="guest-row stat-header" onclick="document.getElementById('${detailId}').classList.toggle('open')">
                        <span style="font-size:17px;">${displayDate}</span>
                        <span class="count-badge">${total}</span>
                    </div>
                    <div id="${detailId}" class="stats-detail">${detailsHTML}</div>
                `;
                container.querySelector('.ios-list').appendChild(div);
            });
            container.innerHTML += '</div>';
        }

        init();
    </script>
</body>
</html>